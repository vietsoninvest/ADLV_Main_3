<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acme De La Vie Sales Dashboard</title>

    <!-- Echarts script -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

    <!-- Password script -->
    <script>
        function getHashCode(str, caseSensitive) {
            if (!caseSensitive) {
                str = str.toLowerCase();
            }
            var hash = 1315423911, i, ch;
            for (i = str.length - 1; i >= 0; i--) {
                ch = str.charCodeAt(i);
                hash ^= ((hash << 5) + ch + (hash >> 2));
            }
            return (hash & 0x7FFFFFFF);
        }

        (function(_0x154739,_0x445971){const _0x631179=_0x8ee4,_0x5e7581=_0x154739();while(!![]){try{const _0xb9de5=-parseInt(_0x631179(0xee))/0x1+parseInt(_0x631179(0xef))/0x2*(-parseInt(_0x631179(0xf6))/0x3)+parseInt(_0x631179(0xe9))/0x4+parseInt(_0x631179(0xf1))/0x5*(parseInt(_0x631179(0xf3))/0x6)+-parseInt(_0x631179(0xf2))/0x7*(-parseInt(_0x631179(0xf7))/0x8)+-parseInt(_0x631179(0xea))/0x9*(-parseInt(_0x631179(0xf0))/0xa)+parseInt(_0x631179(0xf4))/0xb*(parseInt(_0x631179(0xf8))/0xc);if(_0xb9de5===_0x445971)break;else _0x5e7581['push'](_0x5e7581['shift']());}catch(_0x38cf49){_0x5e7581['push'](_0x5e7581['shift']());}}}(_0x5440,0xc4c5b));function _0x5440(){const _0x356d2d=['1129774Suuwsu','2pygYiq','3567880AOvTnG','7615MXQrMO','4175493cqyImU','804OwdOlO','582461pDQRcT','Password\x20wrong','4123662GymZTX','8BrWLKp','60cOJNwr','title','Input\x20password\x20hash:','Attempted\x20too\x20many\x20times,\x20locked','about:blank','href','3271276jShAMd','36dcIMbg','Acme\x20De\x20La\x20Vie\x20Sales\x20Dashboard','Logged\x20in','log'];_0x5440=function(){return _0x356d2d;};return _0x5440();}function _0x8ee4(_0x35521b,_0x4c30d0){const _0x544016=_0x5440();return _0x8ee4=function(_0x8ee4d5,_0x2d59ab){_0x8ee4d5=_0x8ee4d5-0xe8;let _0x2b017a=_0x544016[_0x8ee4d5];return _0x2b017a;},_0x8ee4(_0x35521b,_0x4c30d0);}function password(){const _0x10f413=_0x8ee4;let _0x1a9182=0x0;const _0x886171=0x208eabb3;while(_0x1a9182<0x3){let _0x119c52=prompt('Please\x20input\x20the\x20password');if(_0x119c52===null){location[_0x10f413(0xe8)]=_0x10f413(0xfc);break;}const _0x5ca132=getHashCode(_0x119c52);console[_0x10f413(0xed)](_0x10f413(0xfa),_0x5ca132);if(_0x5ca132===_0x886171){alert(_0x10f413(0xec)),document[_0x10f413(0xf9)]=_0x10f413(0xeb);break;}else alert(_0x10f413(0xf5));_0x1a9182++,_0x1a9182>=0x3&&(alert(_0x10f413(0xfb)),location[_0x10f413(0xe8)]=_0x10f413(0xfc));}}password();    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .header {
            text-align: center;
            padding: 20px;
            background: #f8f8f8;
            font-size: 24px;
            font-weight: bold;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            margin: 20px;
        }
        .chart-container {
            width: 45%;
            height: 400px;
            margin: 20px 0;
        }
        .slicer-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            margin: 20px 0;
        }
        .slicer-container .dropdown {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="header">Acme De La Vie Sales Dashboard</div>

    <div class="slicer-container">
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="outletDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Select Outlet
            </button>
            <div class="dropdown-menu" aria-labelledby="outletDropdown"></div>
        </div>
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="monthDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Select Month
            </button>
            <div class="dropdown-menu" aria-labelledby="monthDropdown"></div>
        </div>
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="yearDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Select Year
            </button>
            <div class="dropdown-menu" aria-labelledby="yearDropdown"></div>
        </div>
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="brandDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Select Brand
            </button>
            <div class="dropdown-menu" aria-labelledby="brandDropdown"></div>
        </div>
        <button class="btn btn-danger" id="resetButton">Reset</button>
    </div>

    <div class="container">
        <div id="pie-chart" class="chart-container"></div>
        <div id="line-chart" class="chart-container"></div>
        <div id="category-by-revenue-chart" class="chart-container"></div>
        <div id="category-by-qty-chart" class="chart-container"></div>
        <div id="top-brand-chart" class="chart-container"></div>
        <div id="platform-chart" class="chart-container"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="./static/Scripts/SalesPie.js"></script>
    <script src="./static/Scripts/SalesLine.js"></script>
    <script src="./static/Scripts/CategoryByRevenue.js"></script>
    <script src="./static/Scripts/CategoryByQty.js"></script>
    <script src="./static/Scripts/TopBrand.js"></script>
    <script src="./static/Scripts/Platform.js"></script>

    <script>
        console.log("Starting main script...");

        const startYear = 2021;
        const startMonth = 1;
        const endMonth = 12;
        const currentYear = new Date().getFullYear();

        const jsonFiles = [];

        // Dynamically generate the list of JSON file paths
        for (let year = startYear; year <= currentYear; year++) {
            for (let month = startMonth; month <= endMonth; month++) {
                const monthStr = month.toString().padStart(2, '0');
                const filePath = `./Json/${year}/data_month_${month}.json`;
                jsonFiles.push(filePath);
            }
        }
        console.log("Generated JSON file paths: ", jsonFiles);

        // Function to fetch all JSON files and combine the data
        async function fetchData() {
            let combinedData = [];
            for (const file of jsonFiles) {
                try {
                    const response = await fetch(file);
                    if (!response.ok) {
                        throw new Error(`Failed to fetch ${file}: ${response.statusText}`);
                    }
                    const data = await response.json();
                    combinedData = combinedData.concat(data);
                } catch (error) {
                    console.error(`Error fetching ${file}:`, error.message);
                }
            }
            return combinedData;
        }

        // Fetch and process the data
        fetchData().then(data => {
            console.log("Data received: ", data);

            const years = [...new Set(data.map(item => new Date(item.Date).getFullYear()))];
            const months = [...new Set(data.map(item => new Date(item.Date).getMonth() + 1))];
            const outlets = [...new Set(data.map(item => item.Outlet))];
            const brands = [...new Set(data.map(item => item.Brand))];

            const yearDropdown = document.getElementById('yearDropdown');
            const monthDropdown = document.getElementById('monthDropdown');
            const outletDropdown = document.getElementById('outletDropdown');
            const brandDropdown = document.getElementById('brandDropdown');

            // Populate dropdowns
            const populateDropdown = (dropdown, items) => {
                dropdown.nextElementSibling.innerHTML = '';
                items.forEach(item => {
                    const option = document.createElement('a');
                    option.className = 'dropdown-item';
                    option.href = '#';
                    option.textContent = item;
                    dropdown.nextElementSibling.appendChild(option);
                });
            };

            populateDropdown(yearDropdown, years);
            populateDropdown(monthDropdown, months.map(m => new Date(0, m - 1).toLocaleString('default', { month: 'short' })));
            populateDropdown(outletDropdown, outlets);
            populateDropdown(brandDropdown, brands);

            // Set default year to 2024
            if (years.includes(2024)) {
                const defaultYear = Array.from(yearDropdown.nextElementSibling.children).find(option => option.textContent === '2024');
                if (defaultYear) {
                    defaultYear.classList.add('active');
                }
            }

            const updateCharts = () => {
                const selectedYears = [...document.querySelectorAll('#yearDropdown + .dropdown-menu a.active')].map(option => parseInt(option.textContent));
                const selectedMonths = [...document.querySelectorAll('#monthDropdown + .dropdown-menu a.active')].map(option => parseInt(option.getAttribute('data-value')));
                const selectedOutlets = [...document.querySelectorAll('#outletDropdown + .dropdown-menu a.active')].map(option => option.getAttribute('data-value'));
                const selectedBrands = [...document.querySelectorAll('#brandDropdown + .dropdown-menu a.active')].map(option => option.textContent);

                console.log("Selected Years:", selectedYears);
                console.log("Selected Months:", selectedMonths);
                console.log("Selected Outlets:", selectedOutlets);
                console.log("Selected Brands:", selectedBrands);

                const filteredData = data.filter(item =>
                    (selectedYears.length === 0 || selectedYears.includes(new Date(item.Date).getFullYear())) &&
                    (selectedMonths.length === 0 || selectedMonths.includes(new Date(item.Date).getMonth() + 1)) &&
                    (selectedOutlets.length === 0 || selectedOutlets.includes(item.Outlet)) &&
                    (selectedBrands.length === 0 || selectedBrands.includes(item.Brand))
                );

                // Update charts here with filteredData...
            };

            // Event listeners for dropdowns
            document.querySelectorAll('#yearDropdown + .dropdown-menu a').forEach(item => {
                item.addEventListener('click', function () {
                    document.querySelectorAll('#yearDropdown + .dropdown-menu a').forEach(option => option.classList.remove('active'));
                    item.classList.add('active');
                    updateCharts();
                });
            });

            document.querySelectorAll('#brandDropdown + .dropdown-menu a').forEach(item => {
                item.addEventListener('click', function () {
                    item.classList.toggle('active');
                    updateCharts();
                });
            });

            document.querySelectorAll('#outletDropdown + .dropdown-menu a').forEach(item => {
                item.addEventListener('click', function () {
                    item.classList.toggle('active');
                    updateCharts();
                });
            });

            document.querySelectorAll('#monthDropdown + .dropdown-menu a').forEach(item => {
                item.addEventListener('click', function () {
                    item.classList.toggle('active');
                    updateCharts();
                });
            });

            document.getElementById('resetButton').addEventListener('click', function () {
                document.querySelectorAll('#yearDropdown + .dropdown-menu a').forEach(option => option.classList.remove('active'));
                if (years.includes(2024)) {
                    const defaultYear = Array.from(yearDropdown.nextElementSibling.children).find(option => option.textContent === '2024');
                    if (defaultYear) {
                        defaultYear.classList.add('active');
                    }
                }

                document.querySelectorAll('#brandDropdown + .dropdown-menu a').forEach(option => option.classList.remove('active'));
                document.querySelectorAll('#outletDropdown + .dropdown-menu a').forEach(option => option.classList.remove('active'));
                document.querySelectorAll('#monthDropdown + .dropdown-menu a').forEach(option => option.classList.remove('active'));

                updateCharts();
            });

            updateCharts();  // Initial chart rendering with default selections
        }).catch(error => {
            console.error("Error fetching data:", error);
        });

        console.log("Main script executed...");
    </script>
</body>
</html>
